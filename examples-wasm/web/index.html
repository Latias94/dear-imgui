<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dear ImGui Web Demo</title>
    <style>
      html, body { margin: 0; padding: 0; height: 100%; background: #111; }
      #wasm-canvas { display: block; width: 100vw; height: 100vh; }
    </style>
  </head>
  <body>
    <canvas id="wasm-canvas"></canvas>
    <script>
      // Prepare a shared memory for both provider (cimgui) and main (wasm-bindgen) modules
      // 256 pages (~16MiB) initial, growable up to 4096 pages (~256MiB)
      if (!globalThis.__imgui_shared_memory) {
        // Use a larger initial heap so provider static data placed high (GLOBAL_BASE) fits
        // 2048 pages = 128MiB
        globalThis.__imgui_shared_memory = new WebAssembly.Memory({ initial: 2048, maximum: 4096 });
      }

      // Ensure canvas drawing buffer matches CSS size * devicePixelRatio
      const canvas = document.getElementById('wasm-canvas');
      function resizeCanvasToDisplaySize() {
        const dpr = window.devicePixelRatio || 1;
        const displayWidth = Math.floor(canvas.clientWidth * dpr);
        const displayHeight = Math.floor(canvas.clientHeight * dpr);
        if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
          canvas.width = displayWidth;
          canvas.height = displayHeight;
        }
      }
      window.addEventListener('resize', resizeCanvasToDisplaySize);
      resizeCanvasToDisplaySize();
    </script>
    <script type="module">
      import init from './dear-imgui-web-demo.js';
      init().catch(e => {
        const msg = String(e && (e.message || e));
        // Winit on web may throw to control flow; ignore this benign exception
        if (msg.includes("Using exceptions for control flow")) return;
        console.error('WASM init failed', e);
      });
    </script>
  </body>
  </html>
